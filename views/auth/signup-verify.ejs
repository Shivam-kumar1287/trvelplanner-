
<%- layout('layouts/boilerplate') %>

<div class="video-container">
  <video autoplay muted loop playsinline class="bg-video">
    <source src="/vedio/trvel.mp4" type="video/mp4">
    <div class="video-fallback"></div>
  </video>

  <div class="overlay"></div>
</div>

<div class="verify-container">
  <div class="verify-card">
    <div class="card-header">
      <div class="verify-icon">
        <svg width="64" height="64" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
          <path d="M22 11.08V12C21.9988 14.1564 21.3005 16.2547 20.0093 17.9818C18.7182 19.709 16.9033 20.9725 14.8354 21.5839C12.7674 22.1953 10.5573 22.1219 8.53447 21.3746C6.51168 20.6273 4.78465 19.2461 3.61096 17.4371C2.43727 15.628 1.87979 13.4881 2.02168 11.3363C2.16356 9.18455 2.99721 7.13631 4.39828 5.49706C5.79935 3.85781 7.69279 2.71537 9.79619 2.24013C11.8996 1.7649 14.1003 1.98232 16.07 2.85999" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
          <path d="M22 4L12 14.01L9 11.01" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
      </div>
      <h2 class="verify-title">Verify Your Email</h2>
      <p class="sub-text">We've sent a verification code to your email</p>
    </div>

    <div class="email-display">
      <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
        <path d="M4 4H20C21.1 4 22 4.9 22 6V18C22 19.1 21.1 20 20 20H4C2.9 20 2 19.1 2 18V6C2 4.9 2.9 4 4 4Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
        <path d="M22 6L12 13L2 6" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
      </svg>
      <span><strong><%= email %></strong></span>
    </div>

    <% if (typeof message !== 'undefined' && message) { %>
      <div class="alert alert-success" role="alert">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
          <path d="M22 11.08V12C21.9988 14.1564 21.3005 16.2547 20.0093 17.9818C18.7182 19.709 16.9033 20.9725 14.8354 21.5839C12.7674 22.1953 10.5573 22.1219 8.53447 21.3746C6.51168 20.6273 4.78465 19.2461 3.61096 17.4371C2.43727 15.628 1.87979 13.4881 2.02168 11.3363C2.16356 9.18455 2.99721 7.13631 4.39828 5.49706C5.79935 3.85781 7.69279 2.71537 9.79619 2.24013C11.8996 1.7649 14.1003 1.98232 16.07 2.85999" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
          <path d="M22 4L12 14.01L9 11.01" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
        <%= message %>
      </div>
    <% } %>

    <% if (typeof error !== 'undefined' && error) { %>
      <div class="alert alert-danger" role="alert">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
          <path d="M12 22C17.5228 22 22 17.5228 22 12C22 6.47715 17.5228 2 12 2C6.47715 2 2 6.47715 2 12C2 17.5228 6.47715 22 12 22Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
          <path d="M15 9L9 15" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
          <path d="M9 9L15 15" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
        <%= error %>
      </div>
    <% } %>

    <form method="POST" action="/signup/verify" class="verify-form">
      <input type="hidden" name="email" value="<%= email %>">
      
      <div class="input-group">
        <input id="otp" name="otp" type="text" required class="input-field" placeholder="Enter 6-digit code" maxlength="6" pattern="[0-9]{6}" inputmode="numeric">
        <label for="otp" class="input-label">Verification Code</label>
        <div class="input-icon">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M12 15V17M6 21H18C19.1046 21 20 20.1046 20 19V13C20 11.8954 19.1046 11 18 11H6C4.89543 11 4 11.8954 4 13V19C4 20.1046 4.89543 21 6 21ZM16 11V7C16 4.79086 14.2091 3 12 3C9.79086 3 8 4.79086 8 7V11H16Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
          </svg>
        </div>
      </div>

      <button type="submit" class="verify-btn w-100">
        <span class="btn-text">Verify & Create Account</span>
        <div class="btn-loader"></div>
      </button>
    </form>

    <div class="action-links">
      <form id="resendForm" method="POST" action="/signup/resend" class="resend-form">
        <input type="hidden" name="email" value="<%= email %>">
        <button id="resendBtn" class="link-btn" type="submit">
          <span class="btn-text">Resend OTP</span>
          <span class="countdown"></span>
        </button>
      </form>

      <a href="/signup" class="link-btn change-email">
        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
          <path d="M19 12H5M5 12L12 19M5 12L12 5" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
        Change Email
      </a>
    </div>

    <div class="help-text">
      <p>If you didn't receive the email, check your spam folder or try resending after the countdown ends.</p>
    </div>
  </div>
</div>

<style>
  :root {
    --primary-gradient: linear-gradient(135deg, #6a11cb 0%, #2575fc 100%);
    --secondary-gradient: linear-gradient(135deg, #2575fc 0%, #6a11cb 100%);
    --info-gradient: linear-gradient(135deg, #11998e 0%, #38ef7d 100%);
    --warning-gradient: linear-gradient(135deg, #f7971e 0%, #ffd200 100%);
    --glass-bg: rgba(255, 255, 255, 0.12);
    --glass-border: rgba(255, 255, 255, 0.18);
    --text-primary: #ffffff;
    --text-secondary: rgba(255, 255, 255, 0.85);
    --shadow-primary: 0 20px 40px rgba(0, 0, 0, 0.3);
    --shadow-hover: 0 25px 50px rgba(0, 0, 0, 0.4);
    --border-radius: 16px;
    --transition: all 0.3s cubic-bezier(0.25, 0.8, 0.25, 1);
  }

  * {
    box-sizing: border-box;
    margin: 0;
    padding: 0;
  }

  body {
    font-family: 'Segoe UI', system-ui, -apple-system, sans-serif;
    color: var(--text-primary);
    overflow-x: hidden;
  }

  .video-container {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    overflow: hidden;
    z-index: -2;
  }

  .bg-video {
    width: 100%;
    height: 100%;
    object-fit: cover;
    filter: brightness(0.7);
    transition: filter 0.5s ease;
  }

  .video-fallback {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: linear-gradient(135deg, #1a2a6c, #b21f1f, #2575fc);
    z-index: -1;
  }

  .overlay {
    position: absolute;
    width: 100%;
    height: 100%;
    top: 0;
    left: 0;
    background: linear-gradient(
      135deg,
      rgba(0, 0, 0, 0.5) 0%,
      rgba(0, 0, 0, 0.4) 50%,
      rgba(0, 0, 0, 0.5) 100%
    );
    z-index: -1;
  }

  .verify-container {
    display: flex;
    justify-content: center;
    align-items: center;
    min-height: 100vh;
    padding: 30px;
    position: relative;
    z-index: 5;
  }

  .verify-card {
    background: var(--glass-bg);
    backdrop-filter: blur(20px) saturate(180%);
    -webkit-backdrop-filter: blur(20px) saturate(180%);
    border: 1px solid var(--glass-border);
    border-radius: var(--border-radius);
    padding: 50px 40px 40px;
    box-shadow: var(--shadow-primary);
    width: 100%;
    max-width: 480px;
    color: var(--text-primary);
    transition: var(--transition);
    position: relative;
    overflow: hidden;
  }

  .verify-card::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    height: 4px;
    background: var(--info-gradient);
  }

  .verify-card:hover {
    box-shadow: var(--shadow-hover);
    transform: translateY(-5px);
  }

  .card-header {
    margin-bottom: 30px;
    text-align: center;
  }

  .verify-icon {
    margin-bottom: 20px;
    color: #38ef7d;
  }

  .verify-title {
    font-size: 2.2rem;
    font-weight: 700;
    margin-bottom: 12px;
    background: var(--info-gradient);
    -webkit-background-clip: text;
    background-clip: text;
    color: transparent;
    letter-spacing: -0.5px;
  }

  .sub-text {
    font-size: 1.1rem;
    opacity: 0.85;
    font-weight: 400;
    line-height: 1.5;
  }

  .email-display {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 10px;
    background: rgba(255, 255, 255, 0.1);
    padding: 15px 20px;
    border-radius: 12px;
    margin-bottom: 30px;
    font-size: 1.05rem;
    border: 1px solid rgba(255, 255, 255, 0.15);
  }

  .verify-form {
    width: 100%;
    margin-bottom: 25px;
  }

  .input-group {
    position: relative;
    margin-bottom: 25px;
  }

  .input-field {
    width: 100%;
    padding: 18px 50px 10px 50px;
    border-radius: 12px;
    border: 1.5px solid rgba(255, 255, 255, 0.2);
    outline: none;
    font-size: 1.1rem;
    font-weight: 600;
    letter-spacing: 8px;
    text-align: center;
    background: rgba(255, 255, 255, 0.1);
    color: var(--text-primary);
    transition: var(--transition);
  }

  .input-field::placeholder {
    color: transparent;
    letter-spacing: normal;
  }

  .input-field:focus {
    background: rgba(255, 255, 255, 0.15);
    border-color: rgba(255, 255, 255, 0.5);
    box-shadow: 0 0 0 3px rgba(255, 255, 255, 0.1);
    letter-spacing: 8px;
  }

  .input-label {
    position: absolute;
    top: 50%;
    left: 50px;
    transform: translateY(-50%);
    color: rgba(255, 255, 255, 0.7);
    font-size: 1rem;
    pointer-events: none;
    transition: var(--transition);
  }

  .input-field:focus + .input-label,
  .input-field:not(:placeholder-shown) + .input-label {
    top: 12px;
    font-size: 0.8rem;
    color: rgba(255, 255, 255, 0.9);
    left: 20px;
  }

  .input-icon {
    position: absolute;
    left: 18px;
    top: 50%;
    transform: translateY(-50%);
    color: rgba(255, 255, 255, 0.7);
    transition: var(--transition);
  }

  .input-field:focus ~ .input-icon {
    color: rgba(255, 255, 255, 0.9);
  }

  .alert {
    display: flex;
    align-items: center;
    gap: 12px;
    padding: 16px 20px;
    border-radius: 12px;
    margin-bottom: 25px;
    font-weight: 500;
    text-align: left;
    border: 1px solid transparent;
  }

  .alert-success {
    background: rgba(56, 239, 125, 0.15);
    border-color: rgba(56, 239, 125, 0.3);
    color: #a0f5c2;
  }

  .alert-danger {
    background: rgba(220, 53, 69, 0.15);
    border-color: rgba(220, 53, 69, 0.3);
    color: #ff9aa3;
  }

  .verify-btn {
    background: var(--info-gradient);
    border: none;
    padding: 18px;
    border-radius: 12px;
    font-size: 1.1rem;
    color: white;
    cursor: pointer;
    transition: var(--transition);
    font-weight: 600;
    position: relative;
    overflow: hidden;
    display: flex;
    justify-content: center;
    align-items: center;
    height: 56px;
  }

  .verify-btn:hover {
    background: linear-gradient(135deg, #0f7c6c 0%, #2fd671 100%);
    transform: translateY(-3px);
    box-shadow: 0 10px 20px rgba(0, 0, 0, 0.2);
  }

  .verify-btn:active {
    transform: translateY(-1px);
  }

  .btn-text {
    transition: opacity 0.3s ease;
  }

  .btn-loader {
    display: none;
    width: 20px;
    height: 20px;
    border: 2px solid transparent;
    border-top: 2px solid white;
    border-radius: 50%;
    animation: spin 1s linear infinite;
    position: absolute;
  }

  .verify-btn.loading .btn-text {
    opacity: 0;
  }

  .verify-btn.loading .btn-loader {
    display: block;
  }

  @keyframes spin {
    0% { transform: rotate(0deg); }
    100% { transform: rotate(360deg); }
  }

  .action-links {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 25px;
    gap: 15px;
  }

  .resend-form {
    flex: 1;
  }

  .link-btn {
    display: flex;
    align-items: center;
    gap: 8px;
    background: none;
    border: 1px solid rgba(255, 255, 255, 0.2);
    color: var(--text-secondary);
    padding: 12px 20px;
    border-radius: 10px;
    text-decoration: none;
    font-size: 0.95rem;
    font-weight: 500;
    transition: var(--transition);
    cursor: pointer;
    width: 100%;
    justify-content: center;
  }

  .link-btn:hover {
    background: rgba(255, 255, 255, 0.1);
    color: white;
    border-color: rgba(255, 255, 255, 0.3);
    transform: translateY(-2px);
  }

  .link-btn:disabled {
    opacity: 0.6;
    cursor: not-allowed;
    transform: none;
  }

  .change-email {
    flex: 1;
  }

  .help-text {
    text-align: center;
    margin-top: 20px;
    padding-top: 20px;
    border-top: 1px solid rgba(255, 255, 255, 0.1);
  }

  .help-text p {
    font-size: 0.9rem;
    color: var(--text-secondary);
    line-height: 1.5;
  }

  .countdown {
    font-weight: 600;
    color: #38ef7d;
  }

  @media (max-width: 576px) {
    .verify-container {
      padding: 20px;
    }
    
    .verify-card {
      padding: 40px 25px 30px;
    }
    
    .verify-title {
      font-size: 1.8rem;
    }
    
    .input-field {
      padding: 16px 45px 8px 45px;
      font-size: 1rem;
    }
    
    .input-label {
      left: 45px;
    }
    
    .action-links {
      flex-direction: column;
    }
    
    .link-btn {
      width: 100%;
    }
  }

  @media (prefers-reduced-motion: reduce) {
    * {
      animation-duration: 0.01ms !important;
      animation-iteration-count: 1 !important;
      transition-duration: 0.01ms !important;
    }
    
    .verify-card:hover {
      transform: none;
    }
    
    .verify-btn:hover {
      transform: none;
    }
    
    .link-btn:hover {
      transform: none;
    }
  }
</style>

<script>
  document.addEventListener('DOMContentLoaded', function() {
    const verifyForm = document.querySelector('.verify-form');
    const verifyBtn = document.querySelector('.verify-btn');
    
    if (verifyForm) {
      verifyForm.addEventListener('submit', function() {
        verifyBtn.classList.add('loading');
        
        setTimeout(() => {
          verifyBtn.classList.remove('loading');
        }, 3000);
      });
    }
    
    const otpInput = document.getElementById('otp');
    if (otpInput) {
      otpInput.addEventListener('input', function() {
        this.value = this.value.replace(/\D/g, '');
        
        if (this.value.length > 6) {
          this.value = this.value.slice(0, 6);
        }
        
        if (this.value.length > 0) {
          this.parentElement.classList.add('focused');
        } else {
          this.parentElement.classList.remove('focused');
        }
      });
      
      otpInput.addEventListener('input', function() {
        if (this.value.length === 6) {
          verifyForm.requestSubmit();
        }
      });
    }
    
    const resendBtn = document.getElementById('resendBtn');
    const resendForm = document.getElementById('resendForm');
    const countdownElement = resendBtn.querySelector('.countdown');
    let cooldown = 30; // seconds
    let isCooldownActive = false;
    
    function startCooldown() {
      if (isCooldownActive) return;
      
      isCooldownActive = true;
      resendBtn.disabled = true;
      const originalText = resendBtn.querySelector('.btn-text').textContent;
      let remaining = cooldown;
      
      countdownElement.textContent = `(${remaining}s)`;
      
      const interval = setInterval(() => {
        remaining -= 1;
        countdownElement.textContent = `(${remaining}s)`;
        
        if (remaining <= 0) {
          clearInterval(interval);
          resendBtn.disabled = false;
          countdownElement.textContent = '';
          isCooldownActive = false;
        }
      }, 1000);
    }
    
 
    
    resendForm.addEventListener('submit', (e) => {
      startCooldown();
    });
    
    const inputs = document.querySelectorAll('.input-field');
    inputs.forEach(input => {
      input.addEventListener('focus', function() {
        this.parentElement.classList.add('focused');
      });
      
      input.addEventListener('blur', function() {
        if (this.value === '') {
          this.parentElement.classList.remove('focused');
        }
      });
      
      if (input.value !== '') {
        input.parentElement.classList.add('focused');
      }
    });
  });
</script>